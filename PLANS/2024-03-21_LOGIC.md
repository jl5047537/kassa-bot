# Логика работы системы (21.03.2024)

## 1. Типы пользователей

### 1.1 Администратор (level 777)
- Имеет доступ к админ-панели
- Может управлять наставниками и пользователями
- Может изменять настройки системы
- Определяется по номеру телефона в таблице admins
- Является наставником для уровня 1

### 1.2 Наставники (levels 1-4)
- Предустановленные пользователи
- Каждый уровень имеет своего наставника
- Помогают обычным пользователям
- Иерархия наставничества:
  - Уровень 1 -> Наставник: Администратор (level 777)
  - Уровень 2 -> Наставник: Уровень 1
  - Уровень 3 -> Наставник: Уровень 2
  - Уровень 4 -> Наставник: Уровень 3
- Определяются по номеру телефона в таблице preset_users

### 1.3 Обычные пользователи (level 0)
- Начинают с нулевого уровня
- Прикрепляются к наставнику уровня 4
- Могут повышать уровень, приглашая других пользователей
- Создаются при регистрации, если номер не найден в других таблицах

## 2. Процесс регистрации

### 2.1 Шаги регистрации
1. Пользователь нажимает "Зарегистрироваться"
2. Отправляет свой номер телефона
3. Бот проверяет номер:
   - В таблице admins -> создается администратор (level 777)
   - В таблице preset_users -> создается наставник
   - Не найден -> создается обычный пользователь (level 0)

### 2.2 Проверка номера телефона
- Номер очищается от всех нецифровых символов
- Проверяется длина (11 цифр)
- Проверяется начало (7 или 8)
- Проверяется наличие в таблицах

## 3. Связи между пользователями

### 3.1 Иерархия наставничества
- Обычный пользователь (level 0) -> Наставник уровня 4
- Наставник уровня 4 -> Наставник уровня 3
- Наставник уровня 3 -> Наставник уровня 2
- Наставник уровня 2 -> Наставник уровня 1
- Наставник уровня 1 -> Администратор (level 777)

### 3.2 Реферальная система
- Пользователь приглашает других -> получает рефералов
- При достижении определенного количества -> повышается уровень
- При повышении уровня -> меняется наставник

## 4. Хранение данных

### 4.1 Формат номеров телефонов
- Хранятся без + и других символов
- Только цифры
- Длина 11 символов
- Начинаются с 7 или 8

### 4.2 Таблицы базы данных
- admins: администраторы (level 777)
- preset_users: наставники (levels 1-4)
- users: обычные пользователи (level 0)
- referrals: реферальные связи

## 5. Процесс повышения уровня

### 5.1 Требования
- Уровень 1: X рефералов
- Уровень 2: Y рефералов
- Уровень 3: Z рефералов
- Уровень 4: W рефералов

### 5.2 Действия при повышении
1. Проверка количества рефералов
2. Изменение уровня пользователя
3. Назначение нового наставника
4. Уведомление пользователя

## 6. Обработка ошибок

### 6.1 Типы ошибок
- Неверный формат номера
- Пользователь уже существует
- Наставник не найден
- Ошибка при создании пользователя

### 6.2 Действия при ошибках
- Информирование пользователя
- Логирование ошибки
- Возможность повторной попытки
- Обращение к администратору при необходимости 